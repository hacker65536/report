# kubernetes meet up tokyo 18

kubebuilder/controller-runtime 入門
-- 



Container-native ingress controller with kubebuilder/(Admission Webhook) 
--

GKE igress(nomal)

vpc ネイティブの有効化　
- GKEクラスタ構築時に設定
- 今後はデフォルトで有効化されていく予定
- container-native load balancing 利用時は必須

pod宛に転送


instance groups(IGs) vs network endopoint groups (NEGs)

Nginx ingress

L7を処理するpodを作成してオフロードする

必要なりソース
- deployment (nginx ingress)
- Service (type: LoadBalancer)
- (HorizontalPodAutoscaler)


GKEとの違い
1. Deploymentやserviceなどをいちいちつくる必要がある
2. ingress classを利用しないとリソースごとに分離できない


GKEの場合ingressリソースごとにGCLBが作成される
Nignx ingressの場合は必要ならばingress-classで分割


AKE Ingress controller v1 (2017-12-

ingress controller = l7 lb を作る

いい感じにリソースを操作することでGKELIKEなIngressを実現

ControllerによりオペレーションをProgrammingで自動化


AKE Ingress v2(container-native)

L7LBを外側に構築

v1 L4LB

v2 L4LB + VM (nginx + calico)

calicoによりVMからPodへの疎通性確保

Calico大変そう？
データセンターなどでバッティングしそう
- vmに対して伝播しているだけ
- nginx ingressからpodへの疎通性確保

バグ多そう　実装とても大変そう

既存のNginx-ingressを利用することで大幅な実装コストダウン
- Nginx-ingressが各エントリはもともとPodのIPAddress
- あくまで構築・運用の範囲をController化しただけ

Heat*のAPIを叩いてVMClusterが起動するのを待つ
- レプリカ数など管理するものが多い
  - IngressリソースのAnnotationに保持？
- コントロール対象（関心事）は狭めたい

HeatStackとDeploymentの違い

HeatStackController
VMClusterを作ることだけに集中
ステータスにHeatのOutputと動機
StatusSubresourceを有効化
レプリカ以外が書き換えられると困る・・・。
すべてのVMを再構築してしまう可能性（Heatの仕様）
ValidatingWebhook
